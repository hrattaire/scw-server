version: "3.8"

services:
  transmission:
    build: ./transmission
    command: --config-dir=/config
    volumes:
      - ${TRANSMISSION_CONFIG_DIR}:/config
      - ${TORRENT_DOWNLOAD_DIR}:/downloads
    ports:
      - "51413:51413"
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 100M
        reservations:
          cpus: "0.25"
          memory: 20M
  web:
    build: ./web
    environment:
      - WEB_DOMAIN="${WEB_DOMAIN}"
      - TRANSMISSION_HOST=${TRANSMISSION_HOST}
      - SSL_CERTIF=${SSL_CERTIF}
      - SSL_CERTIF_KEY=${SSL_CERTIF_KEY}
      - NGINX_HTPASSWD=${NGINX_HTPASSWD}
    volumes:
      - ${TORRENT_DOWNLOAD_DIR}:/var/Downloads
      - ${NGINX_WEB_DIR}:/var/www
      - ${NGINX_WEB_SECRETS}:/etc/secrets
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - transmission
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 100M
        reservations:
          cpus: "0.25"
          memory: 20M
